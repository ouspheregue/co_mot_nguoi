// ==UserScript==
// @name         w-e-b-t-o-o-n-k-a-k-a-o
// @namespace    https://github.com/ouspheregue/co_mot_nguoi/raw/main/w-e-b-t-o-o-n-k-a-k-a-o.user.js
// @version      2024.08.16.1
// @description  down w-e-b-t-o-o-n-k-a-k-a-o
// @author       You
// @include      /^https:\/\/w[e3]bt[o0][o0]n\.k[a@]ka[o0]\.c[o0]m\/vi[e3]wer\//
// @icon         https://raw.githubusercontent.com/ouspheregue/co_mot_nguoi/main/w-e-b-t-o-o-n-k-a-k-a-o.png
// @grant        GM_download
// @grant        GM_info
// @downloadURL  https://github.com/ouspheregue/co_mot_nguoi/raw/main/w-e-b-t-o-o-n-k-a-k-a-o.user.js
// @updateURL    https://github.com/ouspheregue/co_mot_nguoi/raw/main/w-e-b-t-o-o-n-k-a-k-a-o.meta.js
// ==/UserScript==

const a0_0x5673bc=a0_0x2027;(function(_0x18cf73,_0x45ad4f){const _0x4fe0de=a0_0x2027,_0x2a414f=_0x18cf73();while(!![]){try{const _0x56fb8f=-parseInt(_0x4fe0de(0x14c))/0x1*(parseInt(_0x4fe0de(0x154))/0x2)+parseInt(_0x4fe0de(0x147))/0x3*(parseInt(_0x4fe0de(0x173))/0x4)+parseInt(_0x4fe0de(0x13d))/0x5+parseInt(_0x4fe0de(0x13e))/0x6*(parseInt(_0x4fe0de(0x125))/0x7)+parseInt(_0x4fe0de(0x111))/0x8*(-parseInt(_0x4fe0de(0x169))/0x9)+parseInt(_0x4fe0de(0x17a))/0xa+parseInt(_0x4fe0de(0x15b))/0xb*(-parseInt(_0x4fe0de(0x149))/0xc);if(_0x56fb8f===_0x45ad4f)break;else _0x2a414f['push'](_0x2a414f['shift']());}catch(_0x577e07){_0x2a414f['push'](_0x2a414f['shift']());}}}(a0_0x5b0d,0x8de35));let downloading_current=0x0,downloading_total=0x0,folder_title='';const downloadMode=GM_info[a0_0x5673bc(0x142)];function sleep(_0x2b740a){return new Promise(_0x412c64=>setTimeout(_0x412c64,_0x2b740a));}const decrypt_kakao_webtoon=async _0x432bca=>{const _0x41f7e6=a0_0x5673bc,_0x132d38=_0x432bca[_0x41f7e6(0x10e)],_0x3fb74a=_0x432bca[_0x41f7e6(0x13a)],_0x35a5e7=_0x432bca['iv'];return crypto['subtle']['decrypt']({'name':_0x41f7e6(0x16b),'iv':_0x35a5e7},_0x3fb74a,_0x132d38);},download_encrypted=async(_0x5999c6,_0x5540a5,_0x15872d)=>{const _0x32d2df=a0_0x5673bc,_0x37f603=await fetch(_0x5999c6,{'headers':{'origin':_0x32d2df(0x12b)}}),_0x25d3e9=await _0x37f603['arrayBuffer'](),_0x79f58a=await decrypt_kakao_webtoon({'data':_0x25d3e9,'cryptoKey':_0x5540a5[_0x32d2df(0x13a)],'iv':_0x5540a5['iv']});let _0x3d3e44=(''+(_0x15872d+0x1))[_0x32d2df(0x127)](0x3,'0');downloadMode===_0x32d2df(0x179)&&(_0x3d3e44=folder_title+_0x3d3e44);const _0x43e18e=new DataView(_0x79f58a),_0x26b0b8=_0x43e18e[_0x32d2df(0x14d)](0x0,![])[_0x32d2df(0x11b)](0x10);if(_0x26b0b8===_0x32d2df(0x123)){const _0x33a9e0=new Blob([_0x79f58a],{'type':'image/webp'}),_0x1b1c44=URL[_0x32d2df(0x162)](_0x33a9e0);GM_download({'url':_0x1b1c44,'name':_0x3d3e44+_0x32d2df(0x14b)}),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();}else{if(_0x26b0b8===_0x32d2df(0x15c)){const _0x62b68f=new Blob([_0x79f58a],{'type':_0x32d2df(0x128)}),_0x3fb480=URL['createObjectURL'](_0x62b68f);GM_download({'url':_0x3fb480,'name':_0x3d3e44+_0x32d2df(0x161)}),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();}else{const _0x300ac5=new Blob([_0x79f58a],{'type':'image/jpeg'}),_0x473501=URL[_0x32d2df(0x162)](_0x300ac5);GM_download({'url':_0x473501,'name':_0x3d3e44+'.jpg'}),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();}}};function update_status(){const _0x21a02c=a0_0x5673bc;document[_0x21a02c(0x158)](_0x21a02c(0x14e))[_0x21a02c(0x16f)]['display']=_0x21a02c(0x17c),document[_0x21a02c(0x158)](_0x21a02c(0x14e))[_0x21a02c(0x16f)]['alignItems']=_0x21a02c(0x13b),document[_0x21a02c(0x158)](_0x21a02c(0x14e))[_0x21a02c(0x170)]=downloading_current+_0x21a02c(0x10f)+downloading_total;}function create_status_box(){const _0x3d57cd=a0_0x5673bc;let _0x5767d5=document[_0x3d57cd(0x118)]('div');return _0x5767d5[_0x3d57cd(0x12e)]=_0x3d57cd(0x126),_0x5767d5[_0x3d57cd(0x12f)]=downloading_current+'\x20/\x20'+downloading_total,_0x5767d5;}function a0_0x2027(_0x590763,_0x4c2b00){const _0x5b0d28=a0_0x5b0d();return a0_0x2027=function(_0x20275a,_0x56af53){_0x20275a=_0x20275a-0x10e;let _0x4ceb31=_0x5b0d28[_0x20275a];return _0x4ceb31;},a0_0x2027(_0x590763,_0x4c2b00);}function a0_0x5b0d(){const _0x47e169=['heartbeat','getElementsByTagName','toString','click','addEventListener','splice','\x0a\x09.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x09\x09transform-origin:\x20center;\x0a\x09}\x0a\x0a\x09@keyframes\x20heartbeat\x20{\x0a\x09\x090%\x20{\x0a\x09\x09\x09transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09\x0925%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x09\x09}\x0a\x09\x0950%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09\x0975%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x09\x09}\x0a\x09\x09100%\x20{\x0a\x09\x09\x09transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09}\x0a\x09','rel','responseText','userId','52494646','width','91AZinLr','status-num','padStart','image/png','length','link','https://webtoon.kakao.com','1.5rem','https://fonts.googleapis.com/css2?family=Acme&display=swap','className','textContent','load','raw','trim','open','replace','_url','transform','error','importKey','href','cryptoKey','center','body','4338600CaadcX','115656dpuPsU','status','decrypt','display','downloadMode','charCodeAt','call','timestamp','position','3lqRbxt','send','7236vtdJhL','popularity/v1/my-review','.webp','2633YKnlfn','getUint32','.status-num','digest','slice','mediaResources','top','match','12vsNxfW','firstChild','_body','location','querySelector','episode','pointer','25003PubORO','89504e47','#heartbeat','_method','Failed\x20to\x20parse\x20JSON:','head','.png','createObjectURL','popularityReview','media-resources','left','SHA-256','media','POST','64926MEhaHA','includes','AES-CBC','prototype','parse','\x0a\x09.status-num\x20{\x0a\x09\x09font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x09\x09font-size:\x203rem;\x0a\x09\x09color:\x20#FD7377;\x0a\x09\x09-webkit-text-stroke:\x201px\x20#C62428;\x0a\x09\x09border:\x200.2rem\x20solid\x20#167975;\x0a\x09\x09border-radius:\x201rem;\x0a\x09\x09padding:\x200\x202rem;\x0a\x09\x09background-color:\x20#F9FDFD;\x0a\x09\x09box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x09\x09min-height:\x204rem;\x0a\x09\x09display:\x20none;\x0a\x09}\x0a\x09','style','innerHTML','concat','div','3766764nYKAfj','split','map','cursor','absolute','gap','browser','8598390LZzGlG','subtle','flex','data','\x20/\x20','tai-ve','1056ixOqZx','appendChild','setAttribute','insertBefore','10000','zIndex','nonce','createElement'];a0_0x5b0d=function(){return _0x47e169;};return a0_0x5b0d();}function create_download_icon(){const _0x50a8be=a0_0x5673bc;let _0x4a0223=document[_0x50a8be(0x118)](_0x50a8be(0x172)),_0x563d19=document['createElement']('img');_0x563d19[_0x50a8be(0x12e)]=_0x50a8be(0x110),_0x563d19[_0x50a8be(0x113)]('src','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png'),_0x563d19[_0x50a8be(0x16f)][_0x50a8be(0x124)]='3rem',_0x563d19[_0x50a8be(0x16f)][_0x50a8be(0x176)]=_0x50a8be(0x15a),_0x4a0223[_0x50a8be(0x112)](_0x563d19);let _0x2b071d=document['createElement'](_0x50a8be(0x12a));_0x2b071d[_0x50a8be(0x120)]='stylesheet',_0x2b071d[_0x50a8be(0x139)]=_0x50a8be(0x12d),document[_0x50a8be(0x11a)](_0x50a8be(0x160))[0x0][_0x50a8be(0x112)](_0x2b071d);let _0x5d9a0b=document['createElement'](_0x50a8be(0x172));_0x5d9a0b[_0x50a8be(0x12e)]=_0x50a8be(0x13f),_0x5d9a0b[_0x50a8be(0x16f)][_0x50a8be(0x141)]=_0x50a8be(0x17c),_0x5d9a0b['style']['justifyContent']=_0x50a8be(0x13b),_0x5d9a0b[_0x50a8be(0x16f)]['alignItems']=_0x50a8be(0x13b),_0x5d9a0b[_0x50a8be(0x16f)][_0x50a8be(0x178)]=_0x50a8be(0x12c),_0x5d9a0b['style'][_0x50a8be(0x146)]=_0x50a8be(0x177),_0x5d9a0b[_0x50a8be(0x16f)][_0x50a8be(0x116)]=_0x50a8be(0x115),_0x5d9a0b[_0x50a8be(0x16f)][_0x50a8be(0x152)]='0.5rem',_0x5d9a0b[_0x50a8be(0x16f)][_0x50a8be(0x165)]='50vw',_0x5d9a0b[_0x50a8be(0x16f)][_0x50a8be(0x136)]='translate(-50%)';let _0x1d3986=create_status_box();const _0x1c4487=document['createElement'](_0x50a8be(0x16f));_0x1c4487['textContent']=_0x50a8be(0x16e),document[_0x50a8be(0x160)][_0x50a8be(0x112)](_0x1c4487),_0x5d9a0b['appendChild'](_0x4a0223),_0x5d9a0b[_0x50a8be(0x112)](_0x1d3986);let _0x480347=document['querySelector'](_0x50a8be(0x13c)),_0x567f66=_0x480347[_0x50a8be(0x155)];return _0x480347[_0x50a8be(0x114)](_0x5d9a0b,_0x567f66),_0x5d9a0b;}const throttlePromises=async(_0x38ed11,_0x56c48b)=>{const _0x231e84=a0_0x5673bc;while(_0x38ed11[_0x231e84(0x129)]>0x0){await Promise['all'](_0x38ed11[_0x231e84(0x11e)](0x0,_0x56c48b)[_0x231e84(0x175)](_0x4621db=>_0x4621db())),await sleep(0xc8);}},on_heartbeat_css=()=>{const _0x3148ea=a0_0x5673bc;let _0x4254e2=document['querySelector'](_0x3148ea(0x15d));!_0x4254e2&&(_0x4254e2=document['createElement'](_0x3148ea(0x16f)),_0x4254e2[_0x3148ea(0x113)]('id',_0x3148ea(0x119)),document['head'][_0x3148ea(0x112)](_0x4254e2)),_0x4254e2[_0x3148ea(0x12f)]=_0x3148ea(0x11f);},off_heartbeat_css=()=>{const _0x5c10cf=a0_0x5673bc,_0x14cd9f=document['querySelector'](_0x5c10cf(0x15d));_0x14cd9f[_0x5c10cf(0x12f)]='';},create_key_and_iv=async _0x3d2c4a=>{const _0x491741=a0_0x5673bc,{userId:_0xf2e883,episodeId:_0x52e7b5,timestamp:_0x522bb7,nonce:_0x58f663,aid:_0x5018b0,zid:_0x49d240}=_0x3d2c4a,_0x698eaa=''[_0x491741(0x171)](_0xf2e883?_0xf2e883:_0x52e7b5)[_0x491741(0x171)](_0x52e7b5)[_0x491741(0x171)](_0x522bb7),_0x4f58ad=''[_0x491741(0x171)](_0x58f663)['concat'](_0x522bb7);let _0x5cae8e=await de_t(_0x698eaa);const _0x5b689e=_0x5cae8e;_0x5cae8e=await de_t(_0x4f58ad);const _0x275817=_0x5cae8e[_0x491741(0x150)](0x0,0x10),_0x4537b1=z(atob(_0x5018b0)),_0x48b66d=z(atob(_0x49d240));let _0x47420e=await de_p(_0x5b689e);_0x5cae8e=await de_d({'data':_0x4537b1,'cryptoKey':_0x47420e,'iv':_0x275817});const _0xbfc691=_0x5cae8e;_0x5cae8e=await de_d({'data':_0x48b66d,'cryptoKey':_0x47420e,'iv':_0x275817});const _0x1ceeaa=_0x5cae8e;return _0x47420e=await de_p(_0xbfc691),{'cryptoKey':_0x47420e,'iv':_0x1ceeaa};},de_d=async _0x8a120f=>{const _0x4305d0=a0_0x5673bc,_0xa2a67c=_0x8a120f[_0x4305d0(0x10e)],_0x2a3043=_0x8a120f[_0x4305d0(0x13a)],_0x33a3c6=_0x8a120f['iv'];return crypto[_0x4305d0(0x17b)][_0x4305d0(0x140)]({'name':_0x4305d0(0x16b),'iv':_0x33a3c6},_0x2a3043,_0xa2a67c);},de_p=async _0x3d3b44=>crypto['subtle'][a0_0x5673bc(0x138)](a0_0x5673bc(0x131),_0x3d3b44,{'name':a0_0x5673bc(0x16b),'length':0x100},!0x1,['decrypt']),de_t=async _0x4f5ba9=>{const _0x3529d7=a0_0x5673bc,_0x25ddbb=z(_0x4f5ba9);return crypto[_0x3529d7(0x17b)][_0x3529d7(0x14f)](_0x3529d7(0x166),_0x25ddbb);},z=_0x4262e0=>new Uint8Array(_0x4262e0[a0_0x5673bc(0x174)]('')[a0_0x5673bc(0x175)](_0x438259=>_0x438259[a0_0x5673bc(0x143)](0x0))),performFurtherActions=async(_0x68bc50,_0x3d264c,_0x228a05,_0x3672a1)=>{const _0x2f07b5=a0_0x5673bc,_0x17480b=window[_0x2f07b5(0x157)]['href'],_0x54d60b=_0x17480b[_0x2f07b5(0x153)](/\/viewer\/.+?\/(\d+)/),_0x2f673b=Number['parseInt'](_0x54d60b[0x1],0xa),_0x5a5f29=JSON['parse'](_0x68bc50)['data'][_0x2f07b5(0x122)],{aid:_0xd82467,zid:_0x5cae26,files:_0x9cd61}=JSON[_0x2f07b5(0x16d)](_0x3d264c)[_0x2f07b5(0x10e)][_0x2f07b5(0x167)],{title:_0x1318a9}=JSON['parse'](_0x3d264c)['data'][_0x2f07b5(0x159)];folder_title=decodeURIComponent(_0x1318a9)[_0x2f07b5(0x132)]()[_0x2f07b5(0x134)]('.','');folder_title?folder_title+='/':folder_title='';const _0xb5c588={'aid':_0xd82467,'episodeId':_0x2f673b,'nonce':_0x228a05,'timestamp':_0x3672a1,'zid':_0x5cae26,'userId':_0x5a5f29},{cryptoKey:_0x1d083b,iv:_0x47d68a}=await create_key_and_iv(_0xb5c588);if(_0x9cd61[_0x2f07b5(0x129)]>0x0){downloading_total=_0x9cd61['length'];const _0x1b0687=create_download_icon();_0x1b0687[_0x2f07b5(0x11d)](_0x2f07b5(0x11c),async()=>{on_heartbeat_css(),downloading_current=0x0;const _0x3d3acb=_0x9cd61['map']((_0x4bcb01,_0x398a26)=>()=>download_encrypted(_0x4bcb01['url'],{'cryptoKey':_0x1d083b,'iv':_0x47d68a},_0x398a26));await throttlePromises(_0x3d3acb,0x2);});}};(function(){'use strict';const _0x8207d4=a0_0x5673bc;const _0x45c212={'popularityReview':null,'mediaResources':null,'nonce':null,'timestamp':null};function _0xb261ef(){const _0x4aa2d8=a0_0x2027;_0x45c212['popularityReview']&&_0x45c212['mediaResources']&&_0x45c212[_0x4aa2d8(0x117)]&&performFurtherActions(_0x45c212[_0x4aa2d8(0x163)],_0x45c212['mediaResources'],_0x45c212[_0x4aa2d8(0x117)],_0x45c212[_0x4aa2d8(0x145)]);}const _0x6a4cd=XMLHttpRequest[_0x8207d4(0x16c)][_0x8207d4(0x133)],_0x5c973a=XMLHttpRequest[_0x8207d4(0x16c)][_0x8207d4(0x148)];XMLHttpRequest['prototype'][_0x8207d4(0x133)]=function(_0x4a4d37,_0x3adee0,_0x97e403,_0x5d0012,_0x160bad){const _0xc16c77=_0x8207d4;this['_method']=_0x4a4d37,this[_0xc16c77(0x135)]=_0x3adee0,_0x6a4cd['call'](this,_0x4a4d37,_0x3adee0,_0x97e403,_0x5d0012,_0x160bad);},XMLHttpRequest[_0x8207d4(0x16c)]['send']=function(_0x17df37){const _0x32964f=_0x8207d4;if(this[_0x32964f(0x135)][_0x32964f(0x16a)](_0x32964f(0x164))&&this[_0x32964f(0x15e)]===_0x32964f(0x168)){this[_0x32964f(0x156)]=_0x17df37;try{const _0x1c2984=JSON[_0x32964f(0x16d)](this['_body']);_0x45c212['nonce']=_0x1c2984[_0x32964f(0x117)],_0x45c212['timestamp']=_0x1c2984[_0x32964f(0x145)],_0xb261ef();}catch(_0x2a1ec){console[_0x32964f(0x137)](_0x32964f(0x15f),_0x2a1ec);}}this['addEventListener'](_0x32964f(0x130),function(){const _0x22d24f=_0x32964f;if(this['readyState']===0x4&&this[_0x22d24f(0x13f)]===0xc8){if(this[_0x22d24f(0x135)][_0x22d24f(0x16a)](_0x22d24f(0x14a)))_0x45c212[_0x22d24f(0x163)]=this[_0x22d24f(0x121)],_0xb261ef();else this[_0x22d24f(0x135)][_0x22d24f(0x16a)](_0x22d24f(0x164))&&(_0x45c212[_0x22d24f(0x151)]=this['responseText'],_0xb261ef());}}),_0x5c973a[_0x32964f(0x144)](this,_0x17df37);};}());