// ==UserScript==
// @name         w-e-b-t-o-o-n-k-a-k-a-o
// @namespace    https://github.com/ouspheregue/co_mot_nguoi/raw/main/w-e-b-t-o-o-n-k-a-k-a-o.user.js
// @version      2024-08-16
// @description  down w-e-b-t-o-o-n-k-a-k-a-o
// @author       You
// @include      /^https:\/\/w[e3]bt[o0][o0]n.k[a@]ka[o0].c[o0]m/vi[e3]wer\//
// @icon         https://raw.githubusercontent.com/ouspheregue/co_mot_nguoi/main/w-e-b-t-o-o-n-k-a-k-a-o.png
// @grant        GM_download
// @grant        GM_info
// @downloadURL  https://github.com/ouspheregue/co_mot_nguoi/raw/main/w-e-b-t-o-o-n-k-a-k-a-o.user.js
// @updateURL    https://github.com/ouspheregue/co_mot_nguoi/raw/main/w-e-b-t-o-o-n-k-a-k-a-o.meta.js
// ==/UserScript==

const a0_0x392461=a0_0x43c4;function a0_0x1232(){const _0x28b7ca=['.jpg','textContent','location','click','AES-CBC','SHA-256','browser','.png','#heartbeat','stylesheet','link','314624TSxwEt','_url','media','https://webtoon.kakao.com','parseInt','heartbeat','231671QlcTwx','2223KpPLDr','justifyContent','10000','cursor','responseText','left','0.5rem','setAttribute','subtle','popularityReview','div','parse','2817510YKWKHx','src','data','POST','width','\x20/\x20','className','Failed\x20to\x20parse\x20JSON:','_method','image/jpeg','mediaResources','style','center','getElementsByTagName','map','length','1191NoEPQi','3rem','all','89504e47','head','insertBefore','includes','arrayBuffer','2587984QImBDf','tai-ve','firstChild','10sFxTPJ','alignItems','raw','_body','timestamp','50vw','addEventListener','nonce','image/webp','createObjectURL','.status-num','translate(-50%)','call','\x0a\x09.status-num\x20{\x0a\x09\x09font-family:\x20\x27Acme\x27,\x20sans-serif\x20!important;\x0a\x09\x09font-size:\x203rem;\x0a\x09\x09color:\x20#FD7377;\x0a\x09\x09-webkit-text-stroke:\x201px\x20#C62428;\x0a\x09\x09border:\x200.2rem\x20solid\x20#167975;\x0a\x09\x09border-radius:\x201rem;\x0a\x09\x09padding:\x200\x202rem;\x0a\x09\x09background-color:\x20#F9FDFD;\x0a\x09\x09box-shadow:\x200.25rem\x200.4rem\x20#2E8B87;\x0a\x09\x09min-height:\x204rem;\x0a\x09\x09display:\x20none;\x0a\x09}\x0a\x09','episode','digest','send','trim','rel','getUint32','image/png','70312VRBPyC','56860mqMBtl','createElement','split','url','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','absolute','https://fonts.googleapis.com/css2?family=Acme&display=swap','pointer','innerHTML','querySelector','position','display','status-num','open','prototype','img','63iqoYwo','6016KpVsCq','zIndex','\x0a\x09.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x09\x09transform-origin:\x20center;\x0a\x09}\x0a\x0a\x09@keyframes\x20heartbeat\x20{\x0a\x09\x090%\x20{\x0a\x09\x09\x09transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09\x0925%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x09\x09}\x0a\x09\x0950%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09\x0975%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x09\x09}\x0a\x09\x09100%\x20{\x0a\x09\x09\x09transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x09\x09}\x0a\x09}\x0a\x09','load','concat','1368nxVmid','match','appendChild','importKey','slice','decrypt','replace','status','flex','charCodeAt','cryptoKey','media-resources'];a0_0x1232=function(){return _0x28b7ca;};return a0_0x1232();}(function(_0x5531aa,_0x1dd484){const _0x3672de=a0_0x43c4,_0x5e5892=_0x5531aa();while(!![]){try{const _0x4182a0=parseInt(_0x3672de(0x245))/0x1+-parseInt(_0x3672de(0x229))/0x2*(-parseInt(_0x3672de(0x1f7))/0x3)+-parseInt(_0x3672de(0x1ff))/0x4+parseInt(_0x3672de(0x202))/0x5*(parseInt(_0x3672de(0x1e7))/0x6)+-parseInt(_0x3672de(0x228))/0x7*(parseInt(_0x3672de(0x217))/0x8)+parseInt(_0x3672de(0x24c))/0x9*(parseInt(_0x3672de(0x218))/0xa)+-parseInt(_0x3672de(0x24b))/0xb*(parseInt(_0x3672de(0x22e))/0xc);if(_0x4182a0===_0x1dd484)break;else _0x5e5892['push'](_0x5e5892['shift']());}catch(_0x5b33de){_0x5e5892['push'](_0x5e5892['shift']());}}}(a0_0x1232,0xb1171));function a0_0x43c4(_0xca0f78,_0xe921cd){const _0x1232a5=a0_0x1232();return a0_0x43c4=function(_0x43c45a,_0x2aed80){_0x43c45a=_0x43c45a-0x1e0;let _0x1e2c44=_0x1232a5[_0x43c45a];return _0x1e2c44;},a0_0x43c4(_0xca0f78,_0xe921cd);}let downloading_current=0x0,downloading_total=0x0,folder_title='';const downloadMode=GM_info['downloadMode'];function sleep(_0x5477fa){return new Promise(_0x3e0078=>setTimeout(_0x3e0078,_0x5477fa));}const decrypt_kakao_webtoon=async _0x23b99a=>{const _0xe7cf50=a0_0x43c4,_0x4ef418=_0x23b99a[_0xe7cf50(0x1e9)],_0x4966f0=_0x23b99a[_0xe7cf50(0x238)],_0x2c24a2=_0x23b99a['iv'];return crypto[_0xe7cf50(0x1e3)][_0xe7cf50(0x233)]({'name':_0xe7cf50(0x23e),'iv':_0x2c24a2},_0x4966f0,_0x4ef418);},download_encrypted=async(_0x5a82ef,_0xf011ac,_0x42dc53)=>{const _0xba25c9=a0_0x43c4,_0x215e18=await fetch(_0x5a82ef,{'headers':{'origin':_0xba25c9(0x248)}}),_0x396d73=await _0x215e18[_0xba25c9(0x1fe)](),_0x1e4284=await decrypt_kakao_webtoon({'data':_0x396d73,'cryptoKey':_0xf011ac[_0xba25c9(0x238)],'iv':_0xf011ac['iv']});let _0x2ec269=(''+(_0x42dc53+0x1))['padStart'](0x3,'0');downloadMode===_0xba25c9(0x240)&&(_0x2ec269=folder_title+_0x2ec269);const _0x6db4e7=new DataView(_0x1e4284),_0x7bc61e=_0x6db4e7[_0xba25c9(0x215)](0x0,![])['toString'](0x10);if(_0x7bc61e==='52494646'){const _0x2c2891=new Blob([_0x1e4284],{'type':_0xba25c9(0x20a)}),_0x110f0c=URL[_0xba25c9(0x20b)](_0x2c2891);GM_download({'url':_0x110f0c,'name':_0x2ec269+'.webp'}),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();}else{if(_0x7bc61e===_0xba25c9(0x1fa)){const _0xf2cd8c=new Blob([_0x1e4284],{'type':_0xba25c9(0x216)}),_0xae9950=URL[_0xba25c9(0x20b)](_0xf2cd8c);GM_download({'url':_0xae9950,'name':_0x2ec269+_0xba25c9(0x241)}),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();}else{const _0x571834=new Blob([_0x1e4284],{'type':_0xba25c9(0x1f0)}),_0x59c847=URL[_0xba25c9(0x20b)](_0x571834);GM_download({'url':_0x59c847,'name':_0x2ec269+_0xba25c9(0x23a)}),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();}}};function update_status(){const _0x28ced4=a0_0x43c4;document['querySelector'](_0x28ced4(0x20c))[_0x28ced4(0x1f2)][_0x28ced4(0x223)]=_0x28ced4(0x236),document[_0x28ced4(0x221)](_0x28ced4(0x20c))[_0x28ced4(0x1f2)][_0x28ced4(0x203)]=_0x28ced4(0x1f3),document[_0x28ced4(0x221)](_0x28ced4(0x20c))[_0x28ced4(0x220)]=downloading_current+_0x28ced4(0x1ec)+downloading_total;}function create_status_box(){const _0x4c415a=a0_0x43c4;let _0xee877a=document['createElement']('div');return _0xee877a[_0x4c415a(0x1ed)]=_0x4c415a(0x224),_0xee877a[_0x4c415a(0x23b)]=downloading_current+_0x4c415a(0x1ec)+downloading_total,_0xee877a;}function create_download_icon(){const _0x2d6d59=a0_0x43c4;let _0x49f048=document['createElement'](_0x2d6d59(0x1e5)),_0x11afaa=document['createElement'](_0x2d6d59(0x227));_0x11afaa[_0x2d6d59(0x1ed)]=_0x2d6d59(0x200),_0x11afaa[_0x2d6d59(0x1e2)](_0x2d6d59(0x1e8),_0x2d6d59(0x21c)),_0x11afaa[_0x2d6d59(0x1f2)][_0x2d6d59(0x1eb)]=_0x2d6d59(0x1f8),_0x11afaa[_0x2d6d59(0x1f2)][_0x2d6d59(0x24f)]=_0x2d6d59(0x21f),_0x49f048[_0x2d6d59(0x230)](_0x11afaa);let _0x510ce4=document[_0x2d6d59(0x219)](_0x2d6d59(0x244));_0x510ce4[_0x2d6d59(0x214)]=_0x2d6d59(0x243),_0x510ce4['href']=_0x2d6d59(0x21e),document[_0x2d6d59(0x1f4)](_0x2d6d59(0x1fb))[0x0]['appendChild'](_0x510ce4);let _0x1a1174=document[_0x2d6d59(0x219)](_0x2d6d59(0x1e5));_0x1a1174[_0x2d6d59(0x1ed)]=_0x2d6d59(0x235),_0x1a1174[_0x2d6d59(0x1f2)]['display']=_0x2d6d59(0x236),_0x1a1174[_0x2d6d59(0x1f2)][_0x2d6d59(0x24d)]=_0x2d6d59(0x1f3),_0x1a1174[_0x2d6d59(0x1f2)][_0x2d6d59(0x203)]='center',_0x1a1174[_0x2d6d59(0x1f2)]['gap']='1.5rem',_0x1a1174[_0x2d6d59(0x1f2)][_0x2d6d59(0x222)]=_0x2d6d59(0x21d),_0x1a1174[_0x2d6d59(0x1f2)][_0x2d6d59(0x22a)]=_0x2d6d59(0x24e),_0x1a1174[_0x2d6d59(0x1f2)]['top']=_0x2d6d59(0x1e1),_0x1a1174[_0x2d6d59(0x1f2)][_0x2d6d59(0x1e0)]=_0x2d6d59(0x207),_0x1a1174[_0x2d6d59(0x1f2)]['transform']=_0x2d6d59(0x20d);let _0x2ff214=create_status_box();const _0x2ecb8e=document[_0x2d6d59(0x219)](_0x2d6d59(0x1f2));_0x2ecb8e[_0x2d6d59(0x23b)]=_0x2d6d59(0x20f),document[_0x2d6d59(0x1fb)][_0x2d6d59(0x230)](_0x2ecb8e),_0x1a1174[_0x2d6d59(0x230)](_0x49f048),_0x1a1174[_0x2d6d59(0x230)](_0x2ff214);let _0x133b40=document[_0x2d6d59(0x221)]('body'),_0xceb173=_0x133b40[_0x2d6d59(0x201)];return _0x133b40[_0x2d6d59(0x1fc)](_0x1a1174,_0xceb173),_0x1a1174;}const throttlePromises=async(_0x281025,_0x263072)=>{const _0x5efdb7=a0_0x43c4;while(_0x281025[_0x5efdb7(0x1f6)]>0x0){await Promise[_0x5efdb7(0x1f9)](_0x281025['splice'](0x0,_0x263072)[_0x5efdb7(0x1f5)](_0x46cc45=>_0x46cc45())),await sleep(0xc8);}},on_heartbeat_css=()=>{const _0x5d4fbe=a0_0x43c4;let _0x553d5c=document[_0x5d4fbe(0x221)](_0x5d4fbe(0x242));!_0x553d5c&&(_0x553d5c=document[_0x5d4fbe(0x219)](_0x5d4fbe(0x1f2)),_0x553d5c[_0x5d4fbe(0x1e2)]('id',_0x5d4fbe(0x24a)),document[_0x5d4fbe(0x1fb)][_0x5d4fbe(0x230)](_0x553d5c)),_0x553d5c[_0x5d4fbe(0x23b)]=_0x5d4fbe(0x22b);},off_heartbeat_css=()=>{const _0x110a06=a0_0x43c4,_0x1828e3=document[_0x110a06(0x221)]('#heartbeat');_0x1828e3[_0x110a06(0x23b)]='';},create_key_and_iv=async _0x188ed8=>{const _0x304c03=a0_0x43c4,{userId:_0x22a95c,episodeId:_0x4919ac,timestamp:_0x12c902,nonce:_0x4c0fa1,aid:_0x3cc1a0,zid:_0x5b8ed9}=_0x188ed8,_0x215a03=''['concat'](_0x22a95c?_0x22a95c:_0x4919ac)['concat'](_0x4919ac)[_0x304c03(0x22d)](_0x12c902),_0x14a28f=''[_0x304c03(0x22d)](_0x4c0fa1)['concat'](_0x12c902);let _0x5bd844=await de_t(_0x215a03);const _0x3476f2=_0x5bd844;_0x5bd844=await de_t(_0x14a28f);const _0x231774=_0x5bd844[_0x304c03(0x232)](0x0,0x10),_0x346545=z(atob(_0x3cc1a0)),_0x28a328=z(atob(_0x5b8ed9));let _0x2ad2ea=await de_p(_0x3476f2);_0x5bd844=await de_d({'data':_0x346545,'cryptoKey':_0x2ad2ea,'iv':_0x231774});const _0x463636=_0x5bd844;_0x5bd844=await de_d({'data':_0x28a328,'cryptoKey':_0x2ad2ea,'iv':_0x231774});const _0x1ce193=_0x5bd844;return _0x2ad2ea=await de_p(_0x463636),{'cryptoKey':_0x2ad2ea,'iv':_0x1ce193};},de_d=async _0x5a1d16=>{const _0x3b549f=a0_0x43c4,_0x5d9be6=_0x5a1d16[_0x3b549f(0x1e9)],_0x437c6e=_0x5a1d16[_0x3b549f(0x238)],_0x11e309=_0x5a1d16['iv'];return crypto[_0x3b549f(0x1e3)][_0x3b549f(0x233)]({'name':_0x3b549f(0x23e),'iv':_0x11e309},_0x437c6e,_0x5d9be6);},de_p=async _0x15d865=>crypto[a0_0x392461(0x1e3)][a0_0x392461(0x231)](a0_0x392461(0x204),_0x15d865,{'name':a0_0x392461(0x23e),'length':0x100},!0x1,['decrypt']),de_t=async _0x37ed02=>{const _0x57f9ca=a0_0x392461,_0x3ca811=z(_0x37ed02);return crypto['subtle'][_0x57f9ca(0x211)](_0x57f9ca(0x23f),_0x3ca811);},z=_0x193269=>new Uint8Array(_0x193269[a0_0x392461(0x21a)]('')['map'](_0x201b2f=>_0x201b2f[a0_0x392461(0x237)](0x0))),performFurtherActions=async(_0x27b027,_0x1fc021,_0x36ae83,_0x22cc9f)=>{const _0x3313cd=a0_0x392461,_0x4d9757=window[_0x3313cd(0x23c)]['href'],_0x8625c2=_0x4d9757[_0x3313cd(0x22f)](/\/viewer\/.+?\/(\d+)/),_0x34ab66=Number[_0x3313cd(0x249)](_0x8625c2[0x1],0xa),_0x3a1a9f=JSON[_0x3313cd(0x1e6)](_0x27b027)[_0x3313cd(0x1e9)]['userId'],{aid:_0x37bf2a,zid:_0x18125b,files:_0x4a74bb}=JSON['parse'](_0x1fc021)['data'][_0x3313cd(0x247)],{title:_0x386cea}=JSON[_0x3313cd(0x1e6)](_0x1fc021)[_0x3313cd(0x1e9)][_0x3313cd(0x210)];folder_title=decodeURIComponent(_0x386cea)[_0x3313cd(0x213)]()[_0x3313cd(0x234)]('.','');folder_title?folder_title+='/':folder_title='';const _0x2e1113={'aid':_0x37bf2a,'episodeId':_0x34ab66,'nonce':_0x36ae83,'timestamp':_0x22cc9f,'zid':_0x18125b,'userId':_0x3a1a9f},{cryptoKey:_0x3f5d2d,iv:_0x4b70b4}=await create_key_and_iv(_0x2e1113);if(_0x4a74bb[_0x3313cd(0x1f6)]>0x0){downloading_total=_0x4a74bb['length'];const _0x194e5c=create_download_icon();_0x194e5c['addEventListener'](_0x3313cd(0x23d),async()=>{const _0x425555=_0x3313cd;on_heartbeat_css(),downloading_current=0x0;const _0x44404d=_0x4a74bb[_0x425555(0x1f5)]((_0x57b07f,_0x177853)=>()=>download_encrypted(_0x57b07f[_0x425555(0x21b)],{'cryptoKey':_0x3f5d2d,'iv':_0x4b70b4},_0x177853));await throttlePromises(_0x44404d,0x2);});}};(function(){'use strict';const _0x68ef8f=a0_0x392461;const _0x3331b2={'popularityReview':null,'mediaResources':null,'nonce':null,'timestamp':null};function _0x2b6c81(){const _0x55b365=a0_0x43c4;_0x3331b2['popularityReview']&&_0x3331b2[_0x55b365(0x1f1)]&&_0x3331b2[_0x55b365(0x209)]&&performFurtherActions(_0x3331b2[_0x55b365(0x1e4)],_0x3331b2[_0x55b365(0x1f1)],_0x3331b2['nonce'],_0x3331b2['timestamp']);}const _0xad2e2d=XMLHttpRequest['prototype'][_0x68ef8f(0x225)],_0x43b436=XMLHttpRequest[_0x68ef8f(0x226)][_0x68ef8f(0x212)];XMLHttpRequest[_0x68ef8f(0x226)][_0x68ef8f(0x225)]=function(_0x50a522,_0x4dcfac,_0x33e4dc,_0x37e12a,_0x2a5935){const _0x4efc9e=_0x68ef8f;this[_0x4efc9e(0x1ef)]=_0x50a522,this[_0x4efc9e(0x246)]=_0x4dcfac,_0xad2e2d[_0x4efc9e(0x20e)](this,_0x50a522,_0x4dcfac,_0x33e4dc,_0x37e12a,_0x2a5935);},XMLHttpRequest[_0x68ef8f(0x226)][_0x68ef8f(0x212)]=function(_0x23dca8){const _0x4a3d73=_0x68ef8f;if(this[_0x4a3d73(0x246)][_0x4a3d73(0x1fd)]('media-resources')&&this[_0x4a3d73(0x1ef)]===_0x4a3d73(0x1ea)){this[_0x4a3d73(0x205)]=_0x23dca8;try{const _0x55887f=JSON['parse'](this[_0x4a3d73(0x205)]);_0x3331b2[_0x4a3d73(0x209)]=_0x55887f[_0x4a3d73(0x209)],_0x3331b2[_0x4a3d73(0x206)]=_0x55887f[_0x4a3d73(0x206)],_0x2b6c81();}catch(_0x556003){console['error'](_0x4a3d73(0x1ee),_0x556003);}}this[_0x4a3d73(0x208)](_0x4a3d73(0x22c),function(){const _0x4813ac=_0x4a3d73;if(this['readyState']===0x4&&this[_0x4813ac(0x235)]===0xc8){if(this[_0x4813ac(0x246)]['includes']('popularity/v1/my-review'))_0x3331b2[_0x4813ac(0x1e4)]=this[_0x4813ac(0x250)],_0x2b6c81();else this['_url'][_0x4813ac(0x1fd)](_0x4813ac(0x239))&&(_0x3331b2[_0x4813ac(0x1f1)]=this[_0x4813ac(0x250)],_0x2b6c81());}}),_0x43b436[_0x4a3d73(0x20e)](this,_0x23dca8);};}());